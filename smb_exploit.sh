#!/bin/bash
# smb_exploit.sh - SMB vulnerability testing
# Usage: ./smb_exploit.sh TARGET

source "$(dirname "$0")/config.sh" 2>/dev/null || true

if [ -z "$1" ]; then
    echo "Usage: $0 TARGET"
    exit 1
fi

TARGET="$1"

echo "[*] SMB vulnerability testing on $TARGET"

# Check SMB version
echo "[*] SMB version detection:"
nmap -p 445 --script smb-protocols "$TARGET"

# Check for known vulnerabilities
echo -e "\n[*] Checking for common SMB vulnerabilities:"
nmap -p 445 --script smb-vuln* "$TARGET"

# Enumerate shares
echo -e "\n[*] Enumerating SMB shares:"
if command -v smbclient &> /dev/null; then
    smbclient -L "//$TARGET" -N 2>/dev/null || echo "[-] Cannot enumerate shares (auth required)"
fi
